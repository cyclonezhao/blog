---
layout: post
title:  索引基础
date:   2019-04-12 12:37:00:00 +0800
tags:
  - 数据库理论
categories:
  - 软件开发
mathjax: true
---

索引是一种存取结构

# 主索引、聚簇索引和辅助索引
根据字段类型是否码字段，可以有如下第一种索引分类方式：
主索引，如果记录文件使用一非码字段进行物理排序，基于此字段建立的索引称作主索引
聚簇索引，如果记录文件使用一个非码字段进行物理排序，该字段称作聚簇字段，基于聚簇字段建立的索引称作聚簇索引
辅助索引，是基于记录的非排序字段建立的索引
由于一个文件最多只能有一个物理排序字段，因此一个文件最多只能有一个主索引或一个聚簇索引；而辅助索引则可有多个。

磁盘和主存的数据传输单位是磁盘块
一个磁盘块可有多条记录，块因子 bfr (Blocking Factor) 表示一个磁盘块所拥有的记录数。如果取B为一个磁盘块的容量，R为一条记录所占用的容量，则 bfr = \lfloor B/R \rfloor
一个磁盘块的第一条记录称为该块的锚记录，或简称块锚。

主索引是一个有序文件
索引由索引项组成，索引项可表示为<k(i), p(i)>，其中k(i)是块锚的索引字段值，p(i)是指向块锚的指针。一条索引项的长度小于一条记录的长度，因此一个磁盘块可存储更多的索引项。

聚簇索引的索引项也可表示为<k(i), p(i)>。由于聚簇字段在记录文件中的取值不唯一，同一个聚簇字段值对应的记录可能需要存放在一个或多个块中。常见的做法是为每一个值预留一个整块（或一个连续的块簇），k(i)取聚簇字段值，p(i)取指向对应块的首条记录的指针。

# 稠密索引和稀疏索引

根据索引项数目和记录数目的比例，可有如下第二种索引分类方式：
稠密索引，每条记录都存在对应的一条索引项
稀疏索引，只有部分记录有对应的索引项

关于主索引，由于在记录文件中只有块锚才存在对应的索引项，所以是稀疏索引
聚簇索引由于每个聚簇字段值对应一个索引项，而同一个聚簇字段值可能会对应多条记录，所以也是稀疏索引
辅助索引由于使用无序字段作为索引字段，没法使用记录文件的块锚，必须为每个记录建立一个索引项，因此它是稠密索引

# 索引如何提升查询效率

例子1：如果一个磁盘块大小B=1024字节，一个文件包含的记录数r=30000个，每条记录的长度R=100字节，那么存储该文件所需块数b等于多少，二分查找该文件需进行多少次块访问？
解：$ b=\lceil r*R/B \rceil=293 $ 块
块访问次数=$ \lceil \log _{2} b \rceil = 9 $ 次

例子2：在例子1的基础上，如果有建立主索引，其中码字段长9字节（记做K），块指针长6字节（记做P），那么二分查找该索引文件需进行多少次块访问？
解：一条索引项长度 $ R_i=K+P=15 $ 字节，索引块因子（一个磁盘块可以存储的索引项个数）$ bfr_i = \lfloor B/R_i \rfloor = 68$，索引项的总数=记录文件的块数=293块，因此索引文件所需块数$ b_i = \lceil b/bfr_i \rceil = 5$ 块，块访问次数=$ \lceil \log _{2} b_i \rceil + 1 = 3+1 = 4 $ 次，多出的一次是对记录块的访问。

使用索引，若索引文件占有b块，使用二分法，则块访问次数为 向上取整\log _{2} b +1，多出的一次是对记录块的访问。

辅助索引对性能的改善比主索引更显著。这是因为，如果没有辅助索引，那就必须对记录文件进行线性查找，而如果没有主索引，我们还可以对记录文件进行二分查找。

多级索引
扇出 fo
搜索记录需 \log _{fo} b 次块访问，比单级索引所需的次数要小